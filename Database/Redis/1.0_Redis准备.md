## Redis介绍(使用C语言开发)

### 存储结构

Redis是一种NoSQL(Not Only SQL)，Redis是REmote DIctionary Server(远程字典服务器）的缩写，是一个字典结构的存储服务器，并允许其他应用通过`TCP协议读写字典中的内容`。Redis字典中的键值除了可以是字符串，还可以是其他数据类型。到目前为止Redis支持的键值数据类型如下：

1.字符串类型
2. 散列类型
3. 列表类型
3. 集合类型
4. 有序集合类型

### 内存存储与持久化

Redis数据库中的所有数据都存储在内存中。由于内存的读写速度远快于硬盘，因此Redis在性能上对比其他基于硬盘存储的数据库有非常明显的优势，在一台普通的笔记本电脑上，Redis可以在一秒内读写超过十万个键值。

>不过,将数据存储在内存中也有问题，程序退出后内存中的数据会丢失。不过 Redis提供了对持久化的支持，即可以将内存中的数据异步写入到硬盘中，同时不影响继续提供服务。

### Redis支持多种功能的原因

Redis虽然作为数据库开发的，但越来越多的人将其用作`缓存`(由于键可以设置TTL,以及作为缓存系统，Redis还可以限定数据占用的最大内存空间，在数据达到空间限制后可以按照一定的规则自动淘汰不需要的键)、`队列系统`(Redis的列表类型键可以用来实现队列，并且支持阻塞式读取，可以很容易地实现一个高性能的优先级队列。同时在更高层面上，Redis还支持“发布/订阅”的消息模式，可以基于此构建聊天室等系统).

Redis可以为每个键设置`生存时间(Time To Live，TTL）`，生存时间到期后键会自动被删除。这一功能配合出色的性能让Redis可以作为缓存系统来使用，而且由于Redis支持`持久化`和丰富的数据类型，使其成为了`另一个非常流行的缓存系统Memcached的有力竞争者`。

#### Redis与Memcached

`在性能上Redis是单线程模型，而Memcached支持多线程，所以在多核服务器上后者的性能更高一些`。然而,Redis的性能已经足够优异，在绝大部分场合下其性能都不会成为瓶颈。所以更应该关心的是二者在功能上的区别，`如果需要用到高级的数据类型或是持久化等功能，Redis将会是Memcached很好的替代品`。

### Redis命令以及语言支持

Redis提供了一百多个命令，听起来很多，但是常用的却只有十几个，并且每个命令都很容易记忆

Redis提供了几十种不同编程语言的客户端库，这些库都很好地封装了Redis的命令，使得在程序中与Redis进行交互变得更容易。

>读者可以在http://redis.io/commands上查看到所有的redis命令和使用方法

### 安装Redis

Redis的版本规则:Redis约定第一个小数点后的数字为偶数的版本是稳定版(如2.4版、2.6版），奇数的是非稳定版(如2.5版、2.7版），推荐使用稳定版本进行开发和在生产环境使用。

>Redis兼容大部分POSIX系统，在这些系统中推荐直接下载Redis源代码编译安装以获得最新的稳定版本。[Redis最新稳定版本的源代码下载地址](http://download.redis.io/redis-stable.tar.gz)

```shell
wget http://download.redis.io/redis-stable.tar.gz

tar zxf redis-stable.tar.gz

cd redis-stable

# 编译
make

# 如果在编译后执行了make install命令，这些程序会被复制到/usr/local/bin目录内
make install
```

>在实际运行Redis前推荐使用make test命令测试Redis是否编译正确，尤其是在编译一个不稳定版本的Redis时。

除了手工编译外，还可以使用操作系统中的软件包管理器来安装Redis，但目前大多数软件包管理器中的Redis的版本都较古老。考虑到Redis的每次升级都提供了对以往版本的问题修复和性能提升，使用最新版本的Redis往往可以提供更加稳定的体验。如果希望享受包管理器带来的便利，在安装前请确认您使用的软件包管理器中Redis的版本并了解该版本与最新版之间的差异。`http://redis.io/topics/problems中列举了一些在以往版本中存在的已知问题。`



### 启动和停止Redis

考虑到Redis有可能正在将内存中的数据同步到硬盘中，强行终止Redis进程可能会导致数据丢失。正确停止Redis的方式应该是向Redis发送SHUTDOWN命令，方法为：`redis-cli SHUTDOWN`
,当Redis收到SHUTDOWN命令后，会先断开所有客户端连接，然后根据配置`执行持久化`，最后完成退出。

>Redis可以妥善处理SIGTERM信号，所以使用“kill Redis进程的PID”也可以正常结束Redis，效果与发送SHUTDOWN命令一样。

启动Redis有`直接启动`和`通过初始化脚本`启动两种方式，分别适用于`开发环境`和`生产环境`。

>作为服务启动:

`/usr/local/bin/redis-server /etc/redis/redis.conf   # 指定配置文件 启动`

>redis-cli向Redis发送命令时会自动按照默认配置(向服务器地址为127.0.0.1，端口号6379发送命令）,关闭Redis如: `redis-cli SHUTDOWN`,通过-h和-p参数可以自定义地址和端口号：`redis-cli -h 127.0.0.1 -p 6379`
,或者不附带参数运行redis-cli，这样会进入交互模式，可以自由输入命令:

## 多数据库

Redis是一个字典结构的存储服务器，一个Redis实例提供多个字典，客户端将数据存储在某个字典。可以将每个字典都理解成一个独立的数据库。

每个数据库对外都是以一个从0开始的递增数字命名，Redis默认支持16个数据库，可以修改这一数字。客户端与Redis建立连接后会自动选择0号数据库，不过可以随时使用SELECT命令更换数据库，如要选择1号数据库：

```shell
redis>SELECT 1
OK
redis [1]>GET foo
(nil)
```

### 以数字命名的数据库又与我们理解的数据库有何区别?

- Redis不支持自定义数据库的名字，每个数据库都以编号命名，开发者必须自己记录哪些数据库存储了哪些数据
- 另外一个Redis实例也不支持为每个数据库设置不同的访问密码，所以一个客户端要么可以访问全部数据库，要么连一个数据库也没有权限访问
- 最重要的一点是多个数据库之间并不是完全隔离，比如FLUSHALL命令可以清空一个Redis实例中所有数据库中的数据
- 综上所述，这些数据库更像是一种命名空间，而不适宜存储不同应用程序的数据

### 如何利用redis数据库编号存储数据?

- 比如可以使用0号数据库存储某个应用生产环境中的数据，使用1号数据库存储测试环境中的数据
- 但不适宜使用0号数据库存储A应用的数据而使用1号数据库存储B应用的数据
- 不同的应用应该使用不同的Redis实例存储数据
- 由于Redis非常轻量级，一个空Redis实例占用的内存只有1MB左右，所以不用担心多个Redis实例会额外占用很多内存。
