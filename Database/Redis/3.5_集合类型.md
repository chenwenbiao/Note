# 集合类型

## 概念和特点

集合中的每个元素都是不同的，且没有顺序。一个集合类型（set）键可以存储至多2^32-1个字符串。

集合类型的常用操作是向集合中加入或删除元素、判断某个元素是否存在等，由于集合类型在Redis内部是使用值为空的散列表（hash table）实现的，所以这些操作的时间复杂度都是0(1)

```shell
# 增加/删除元素,SADD命令如果键不存在则会自动创建
# 因为在一个集合中不能有相同的元素，所以如果要加入的元素已经存在于集合中就会忽略这个元素。本命令的返回值是成功加入的元素数量.
SADD key member [member …]

# SREM命令用来从集合中删除一个或多个元素，并返回删除成功的个数
# 如果元素不存在，就只删除存在的元素，返回实际删除的元素的数量
SREM key member [member …]

# 获得集合中的所有元素
SMEMBERS key

# 判断元素是否在集合中,判断一个元素是否在集合中是一个时间复杂度为0(1)的操作,
# 无论集合中有多少个元素，SISMEMBER命令始终可以极快地返回结果。当值存在时SISMEMBER命令返回1，当值不存在或键不存在时返回0
SISMEMBER key member

# 集合间运算

# 对多个集合执行差集运算,集合A与集合B的差集表示为A-B，代表所有属于A且不属于B的元素构成的集合
# {1, 2, 3}-{2, 3, 4}={1}, {2, 3, 4}-{1, 2, 3}={4}
SDIFF key [key …]

# 差集
SADD setA 1 2 3
SADD setB 2 3 4
SDIFF setA setB
SDIFF setB setA

# SDIFF 命令支持同时传入多个键
SADD setC 2 3

# 先计算setA-setB，再计算结果与setC的差集
SDIFF setA setB setC

# 交集运算,{1, 2, 3}∩{2, 3, 4}={2, 3}
SINTER key [key …]
SINTER setA setB

# SINTER命令同样支持同时传入多个键
SINTER setA setB setC

# 并集运算,{1, 2, 3}∪{2, 3, 4}={1, 2, 3, 4}
SUNION key [key …]
SUNION setA setB

# SUNION命令同样支持同时传入多个键
SUNION setA setB setC

# 获得集合中元素个数
SCARD key

# 进行集合运算并将结果存储到destination。
SDIFFSTORE destination key [key …]
SINTERSTORE destination key [key …]
SUNIONSTORE destination key [key …]

# 随机从集合中获取一个元素，传递count参数来一次随机获得多个元素
SRANDMEMBER key [count]

# 当count为正数时，SRANDMEMBER会随机从集合里获得count个不重复的元素
# 如果count的值大于集合中的元素个数，则SRANDMEMBER会返回集合中的全部元素。
# 当count为负数时，SRANDMEMBER会随机从集合里获得|count|个的元素，这些元素有可能相同。

# 从集合中弹出一个元素，由于集合类型的元素是无序的，所以SPOP会从集合中随机选择一个元素弹出
SPOP key
```

>集合类型采用的存储结构（散列表）造成的。散列表使用散列函数将元素映射到不同的存储位置（桶）上以实现0(1)时间复杂度的元素查找，举个例子，当使用散列表存储元素b时，使用散列函数计算出b的散列值是0，所以将b存入编号为0 的桶（bucket）中，下次要查找b时就可以用同样的散列函数再次计算b的散列值并直接到相应的桶中找到b。当两个不同的元素的散列值相同时会出现冲突，Redis使用拉链法来解决冲突，即将散列值冲突的元素以链表的形式存入同一桶中，查找元素时先找到元素对应的桶，然后再从桶中的链表中找到对应的元素。使用SRANDMEMBER命令从集合中获得一个随机元素时，Redis首先会从所有桶中随机选择一个桶，然后再从桶中的所有元素中随机选择一个元素，所以元素所在的桶中的元素数量越少，其被随机选中的可能性就越大。

Redis会先从3个桶中随机挑一个非空的桶，然后再从桶中随机选择一个元素，所以选中元素b的概率会大一些，如图:![bucket](./redis-set-bucket.png)