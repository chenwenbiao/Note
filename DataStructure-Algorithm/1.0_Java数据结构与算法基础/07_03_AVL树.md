### AVL树

什么是AVL树，Adelson-Velsky & E. Landis 取名字的缩写,

在AVL的意义下,什么叫作适度的平衡
凭借什么来判断一棵树,是否是在AVL意义下的适度平衡
我们需要用到这样一个指标,叫平衡因子.

对于二叉树中的任何一个节点v都可以定义它的
所谓平衡因子balanced factor：具体来说 也就是它的左子树高度
与右子树高度之差：balFac(v) = height(lc(v)) - height(rc(v))

平衡因子 = 左子树的高度 - 右子树的高度

那么根据AVL树发明者的定义：
所谓AVL树就是其中所有节点的平衡因子
都不超过1,也不小于-1

AVL树本身只考虑左右子树的高度

对于第一个叶节点而言
它的左右子树都是空(空也就是左右后代都没有，没有后代节点存在,所以人为的人为高度均为-1),高度均为-1
所以这个节点的平衡因子
自然就是-1减-1 零

再来看第二个节点
它的左子树高度为零
而右子树高度为-1
所以它的平衡因子应该为正1


因此对于这样一棵BST来说
平衡因子在处处
都上下不超过正负1
因此它的确是一棵名副其实的AVL树
当然从这个例子 我们也可以看出
AVL树未必是完全二叉树,也就是说 它未必是理想平衡
那么反过来 如此定义的AVL树
是否的确是适度平衡的呢？答案是肯定的。

适度平衡也就是说 一棵规模为n的AVL树
其高度在渐近意义下
是不超过logn的(直接用他当结论)

#### AVL插入


可能同时有多个失衡的节点，最低者g不低于x的祖父.
g经过单旋调整后恢复平衡，子树高度 复原，更高祖先也必平衡，全树复衡.

情况1: 我们在某个节点原本已经更高的分支
插入了一个新的节点
这个分支的高度继续上升一层
从而导致它的平衡因子又减少了1，而且我们假设g是所有因此
而发生失衡的祖先中
最深的那个,也就是最先发生失衡的祖先.
尽管一个节点的插入
有可能会导致多个祖先的失衡
其中最低的那个
也不会低于它的祖父辈.那么既然此处已经发生了失衡
我们又当如何令它重新恢复平衡呢？
实际上 我们能做的无非是上一节
所介绍的等价变换
也就是zig或者是zag旋转.

做一次旋转也就是所谓的单旋.从我们刚才失衡的局部出发,接下来我们要围绕着
失衡的节点g,做一次逆时针的zag旋转,这样的一个旋转
可以由接下来的几步组合完成,首先引入一个临时的引用
指向节点p(parent,当前节点x的父亲),接下来 我们要令p的左子树T1
成为g(祖父)的右子树,为此我们只需这样调整好,再接下来 我们要令g
成为p的左孩子,因此需要做这样的调整,再接下来 我们要将局部子树的根
由g替换为p,此时的临时引用,也完成了历史使命
它可以退出了.如果在此前g以上
还有其它的祖先
同时发生失衡
那么在这个局部重新恢复平衡之后
也会同时一揽子地重新获得平衡

我们无非是做了一次zag旋转
这种旋转只涉及到局部的常数个节点
因此它所对应的时间消耗
应该是O(1)的
这个结果也再好不过了
当然这种情况只是所有情况中的一种
其特点是我们刚才所定义的gpv
这连续三代的节点
在方向上是朝向一致的.

