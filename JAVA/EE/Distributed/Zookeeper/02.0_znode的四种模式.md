# Znode

Zookeeper将所有数据存储在内存中，ZNode是ZooKeeper中数据的最小单元,znode用由斜杠分割的路径表示，例如/foo/path1。

>在Zookeeper中，node可以分为持久节点和临时节点两类:

1. 持久节点: 是指一旦被创建了，除非主动进行ZNode的移除操作，否则这个ZNode将一直保存在Zookeeper上。
2. 临时节点就不一样了，它的生命周期和客户端会话绑定，一旦客户端会话失效，那么这个客户端创建的所有临时节点都会被移除。

# ZNode的结构

每个 ZNode 由2部分组成:

- stat：状态信息
- data：数据内容

通过 get 命令来获取根目录下的 dubbo 节点的内容:

```shell
[zk: 127.0.0.1:2181(CONNECTED) 6] get /dubbo    
# 该数据节点关联的数据内容为空
null
# 下面是该数据节点的一些状态信息，其实就是 Stat 对象的格式化输出
cZxid = 0x2
ctime = Tue Nov 27 11:05:34 CST 2018
mZxid = 0x2
mtime = Tue Nov 27 11:05:34 CST 2018
pZxid = 0x3
cversion = 1
dataVersion = 0
aclVersion = 0
ephemeralOwner = 0x0
dataLength = 0
numChildren = 1
```

这些状态信息其实就是 Stat 对象的格式化输出。Stat 类中包含了一个数据节点的所有状态信息的字段，包括事务ID、版本信息和子节点个数等，如下图所示:

![Stat 类](https://images.gitbook.cn/a841e740-1c55-11e9-b5b7-abf0ec0c666a)

![数据节点的状态信息说明](https://images.gitbook.cn/f44d8630-1c55-11e9-b5b7-abf0ec0c666a)

# znode的四种模式

在Zookeeper的数据模型中，Znode分为四种:

1. 持久(persistent)
2. 临时(ephemeral)
3. 持久序列(persistent_sequential)
4. 临时序列(ephemeral_sequential)

从zkCli创建zookeeper znode的创建语法如下:

>create [-s] [-e] path data acl



1、持久模式

创建方式：create path data

持久模式的znode，即使创建该znode的client断开了连接，znode依然存在。当重启zookeeper之后，持久模式的znode也会重新被加载到内存中。

持久模式的znode可以有child node



2、临时模式

创建方式：create -e path data

临时模式的znode，其生命周期与创建其的client相同，当创建其的client与zookeeper服务断开连接时，该临时节点就自动删除。

临时znode不能有child node



3、持久序列模式

创建方式：create -s path data

使用持久序列模式创建一个znode时，znode会自动增加一个编号。该模式创建的znode一般不会都会是其他node的子node。

持久模式的znode可以有child node



4、临时序列模式

创建方式：create -s -e path data

临时序列模式，就是在临时模式的基础上，增加了一个自动编号的功能。一般也会当做其他Node的子Node。

### 2.6 ACL

Zookeeper采用ACL（AccessControlLists）策略来进行权限控制，类似于 UNIX 文件系统的权限控制。Zookeeper 定义了如下5种权限。

![](http://my-blog-to-use.oss-cn-beijing.aliyuncs.com/18-9-10/27473480.jpg)

其中尤其需要注意的是，CREATE和DELETE这两种权限都是针对子节点的权限控制。
