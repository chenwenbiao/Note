# 分布式系统

## CAP

分布式的CAP理论告诉我们，任何一个分布式系统都无法同时满足一致性（Consistency）、可用性（Availability）和分区容错性（Partition tolerance），最多只能同时满足两项。所以，很多系统在设计之初就要对这三者做出取舍。在互联网领域的绝大多数的场景中，都需要牺牲强一致性来换取系统的高可用性，系统往往只需要保证“最终一致性”，只要这个最终时间是在用户可以接受的范围内即可。

- 一致性: 数据的强一致性
- 可用性: 要求系统提供的服务一直处于可用的状态,对于用户的每一个请求总是能够在有限的时间内返回结果。
- 分区容错性: 网络分区故障.(网络出现问题等),指即使出现了网络分区故障,也要保证一致性和可用性.

在分布式系统中，分区容错性要一定要保证，因为网络是不可靠的。你不能出现了网络分区故障,就导致不可用或者数据不一致，

CAP 理论实际上是要在可用性和一致性之间做权衡(CP和AP权衡)。可用性和一致性往往是冲突的，很难使它们同时满足。

>举例,A和B同时打开一个视频,mysql记录了视频的点击播放量,如果mysql先把A这个用户的点击播放量增加,但是此时如果要等到把B的播放量增加之后再返回的话,用户B的感觉就是网站响应太慢了(也就是保证了一致性,但是不能保证高可用),(这里只是2个人,实际可能有很多人同时访问一个视频),所以B只能访问redis缓存中的播放量,因为此时缓存还不是最新的播放量,也就是脏数据,所以这个场景保证了强一致性,就保证不了高可用.保证了高可用,就保证不了强一致,这个也引出了base理论.

## BASE

BASE 是基本可用（Basically Available）、软状态（Soft State）和最终一致性（Eventually Consistent）三个短语的缩写。

BASE 理论是对 CAP 中一致性和可用性权衡的结果，它的核心思想是：即使无法做到强一致性，但每个应用都可以根据自身业务特点，采用适当的方式来使系统达到最终一致性。

## 基本可用（Basically Available）

指分布式系统在出现故障的时候，保证核心可用，允许损失部分可用性。例如，电商在做促销时，为了保证购物系统的稳定性，部分消费者可能会被引导到一个降级的页面。

## 软状态

指允许系统中的数据存在中间状态，并认为该中间状态不会影响系统整体可用性，即允许系统不同节点的数据副本之间进行同步的过程存在时延。

## 最终一致性

最终一致性强调的是系统中所有的数据副本，在经过一段时间的同步后，最终能达到一致的状态。

ACID 要求强一致性，通常运用在传统的数据库系统上。而 BASE 要求最终一致性，通过牺牲强一致性来达到可用性，通常运用在大型分布式系统中。

>一般会牺牲强一致性,保证最终一致性来换取可用性.

在实际的分布式场景中，不同业务单元和组件对一致性的要求是不同的，因此 ACID 和 BASE 往往会结合在一起使用。
