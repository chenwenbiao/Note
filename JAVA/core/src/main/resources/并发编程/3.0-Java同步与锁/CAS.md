## CAS(Java中的非阻塞同步策略)

### 概述

CAS操作，即compareAndSwap,是一种有名的无锁算法。无锁编程，即不使用锁的情况下实现多线程之间的变量同步。
CAS是原子操作。

### CAS指令的原子性

原子操作的业务表现形式是“不可被中断或不可被分割操作”。所谓CAS（Compare And Swap）比较并交换就是一种原子操作。简单来说执行CAS需要两个参数，一个新值，一个旧值，当比较内存的值与旧值相符时，则替换为新值，否则不执行替换操作。Java若要实现CAS则需要CPU指令集配合，JDK1.5加入了这个特性，并在随后的版本对其进行丰富。

>Java是通过一个sun.misc.Unsafe的类，完成CAS指令操作的，然而我们从AQS的源码中也发现了sun.misc.Unsafe类的踪影.

### volatile关键字

>volatile在多线程环境下保证了共享变量内存可见性。意思是线程A修改了volatile修饰的共享变量，线程B能够感知修改。如果volatile合理使用的话，将会比Synchronized的执行成本更低。从底层的角度来说，为了提高处理速度，`CPU不直接和内存进行通信`，而是先将数据读入到CPU缓存后在进行操作，但不知何时将会更新到内存。声明变量加入volatile关键字后，每次修改该变量，JVM就会通知处理器将CPU缓存内的值强制更新到内存中，这就是所谓的“可见性”.

#### volatile和synchronized比较

volatile和synchronized可以实现效果等价，但是性能来说前者更优，原因前面也说了，Synchronized在多线程环境下会引起上下文切换及调度，在并发量大的前提下，有不小的性能开销。因此合理使用volatile有助于我们代码性能的优化。

