## Java并发编程基本知识介绍

### 什么是并发？

并发指的是在同一时刻执行多个任务。

### 进程与线程

Linux上就可以通过fork创建一个进程副本。最简单的情况下，一个应用就是一个进程。

需要注意的是，软件本身就是一个文件而已，当你启动了之后，它才会成为操作系统中的一个进程。操作系统会给进程分配运行时需要的资源，例如内存。

为了方便进程之前的通信，大多数操作系统有支持进程之间相互通信(Inter Process Communication ，IPC)的措施，例如管道、socket等。IPC不仅支持同一个操作系统上进程的通信，也支持不同操作系统上进程的通信。

大部分Java虚拟机的实现都是作为单进程运行的，也就是说，启动Java虚拟机的时候，只会启动一个进程。在Java应用中，我们可以通过ProcessBuilder来创建附加的进程。

线程：我在一个软件内，我们也能同时干多个事，这些不同的功能可以同时进行，是因为在进程内使用了多个线程。线程有时又称之为轻量级进程。但是创建一个线程要消耗的资源通常比创建进程少的多。一个进程内的多个线程会共享进程的资源，同时也会有自己私有的资源。

线程必须存在于进程中，每个进程至少要有一个线程作为程序的入口(主线程)。线程是可以并发执行的。

### 单核与多核

#### 单核

单核(一个CPU):一个cpu，在同一个时间点只能同时运行一个进程，多个任务或多个进程共享一个CPU
，并交由操作系统来完成多任务间对CPU的运行切换，以使得每个任务都有机会获得一定的时间片运行。因为切换的速度足够快，所以感觉上就像是多个软件在同时运行。

类似的，当一个CPU在运行某一个进程的时候，也并不是同时执行多个线程，还是因为不同的线程执行切换的非常快，让我们感觉好像多个线程在同时运行。

事实上，`在一个单核的CPU上，在任一时刻，只有一个进程的中一个线程在运行`。笔者就曾经遇到过这样的面试题，`什么情况下，一个计算机中任一时刻只会有一个线程在运行。这个问题很简单，只要你的CPU是单核的就行了.`

>在单CPU机器上出现，因为两个线程从来不会得到真正的并行执行.

#### 多核

单核CPU之所以同一时刻只能运行一个线程，是因为`一个CPU同一时刻只能处理一个指令`。只有在CPU时多核的情况下，才能实现`真正意义上的并行执行`。如果你的`CPU是双核的，那么就可以同时运行2个线程`，如果是4核的，就可以同时运行4个线程...

### Java与多线程

Java是最先支持多线程的开发的语言之一，Java从一开始就支持了多线程能力。而Java的并发编程是非常具有挑战性的.

多线程比多任务更加有挑战。从进程的层面来说，每个进程只要操作各自的内存空间即可。而多线程是在同一个程序内部并行执行，因此会对相同的内存空间进行并发读写操作。现代的计算机都是多核CPU，也就意味着不同的线程能被不同的CPU核得到真正意义的并行执行,所以会对相同的内存空间进行并发读写操作。

### 并发和并行

可以这样理解:并发指的是"同一时间段"内多个线程同时在运行，并行指的是在"同一时刻"多个线程在运行。 至于到底是否支持并行，这主要看cpu的核心数： 1)在单核的情况，不存在并行，因为单核的情况下，任意时刻只能由一个线程在运行，所以单核并不满足并行的定义。 2)在多核的情况下，是支持并行的。因为多核的情况下，在某一时刻，每个核心可以各自运行一个线程，也就是说支持多个线程在同一时刻运行，这是并行。 最后，对于并发，不管是单核还是多核，都是存在的。因为并发是在某一个时间段多个线程同时运行，即使在单核的情况下，因为线程之前切换非常快，看起来也好像多个线程同时在执行。

## Linux操作系统对线程数的限制

Java里的线程是由JVM来管理的，它如何对应到操作系统的线程是由JVM的实现来确定的,对于JVM而言，默认情况下，一个线程的栈内存是1M。Linux 2.6上的HotSpot使用了NPTL机制，JVM线程跟内核线程有一一对应的关系.这样做的好处是什么？线程的调度完全交给了操作系统内核，当然jvm还保留一些策略足以影响到其内部的线程调度。

## 并发编程模型