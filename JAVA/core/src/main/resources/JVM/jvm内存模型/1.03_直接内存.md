# 直接内存(堆外内存)

`直接内存不是由 JVM虚拟机 所管理的一块内存区域,不属于运行时数据区的一部分`，但是这部分内存也被频繁地使用。堆外内存不能用的太多了,也可能导致OutOfMemoryError异常出现。

通过NIO中的allocateDirect这种API，可以在Java堆外分配内存空间,然后通过Java虚拟机里的 DirectByteBuffer 来引用和操作堆外内存空间，其实很多技术都会用这种方式，因为有一些场景下，堆外内存分配可以提升性能。

JDK1.4中新加入的NIO类,引入了一种基于**通道（Channel）** 与**缓存区（Buffer）** 的 I/O 方式,它可以直接使用Native函数库直接分配堆外内存，然后通过在堆内存中的 `DirectByteBuffer` 对象作为这块内存的引用进行操作堆外内存。这样就能在一些场景中显著提高性能，因为避免了在堆内存和堆外内存来回拷贝数据。这样的高效操作也称为`零拷贝`,避免了在 Java 堆和 Native 堆之间来回复制数据.

    引用在堆内,但是实际的对象在堆外,避免了拷贝.

本机直接内存的分配不会收到 Java 堆的限制，但是，既然是内存就会受到本机总内存大小以及处理器寻址空间的限制。

既然是内存，那也得是可以被回收的。但由于堆外内存不直接受 `JVM` 管理，所以常规 `GC` 操作并不能回收堆外内存。它是借助于老年代产生的 `fullGC` 顺便进行回收。

