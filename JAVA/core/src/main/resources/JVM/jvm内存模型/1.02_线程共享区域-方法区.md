# 方法区(Method Area)

    类加载器读取了类文件后，会把类的结构信息放到方法中,(不要被名字迷惑,不是存放方法的地方)
    
    例如运行时常量池（Runtime Constant Pool）、构造函数,字段,普通方法等类元信息.
    
    方法区在虚拟机启动的时候被创建.对这块区域进行垃圾回收的主要目的是对类的卸载.
    
    永久代和元空间都是方法区的具体实现,永久代是java7,元空间是java8
    
方法区在不同版本的jdk中名字不同，java7中被称为永久代(PermGen space),java8中被称为元空间(Metaspace)。

![](../pics/java8-元空间.png)

# java7-永久代(PermGen space)

可利用参数 `-XX:PermSize 和 -XX:MaxPermSize` 控制方法区的初始大小和方法区的最大大小

    java8中-XX:PermSize 和 -XX:MaxPermSize已经不能使用了,配置这两个参数已经不能控制方法区的大小.

# java8-元空间(Metaspace)

如果不指定该区域的大小，JVM 将会动态的调整。避免了在 1.7 中由于加载类过多从而出现 `java.lang.OutOfMemoryError: PermGen`。

但也不能无线扩展，因此可以使用 `-XX:MaxMetaspaceSize=10M`来控制最大元数据内存。这样当不停的创建类时将会占满该区域并出现 `OOM`

    示例: org.java.core.advanced.jvm.MetaspaceOOM

# 堆和方法区的关系

    方法区可以认为是堆的逻辑组成的一部分.
    
    Java堆中会存放访问类元数据(方法区)的地址.