# JVM内存布局概述

Java虚拟机执行Java程序的过程中会把它所管理的内存划分为若干个不同的数据区域，
主要包括:

* 虚拟机栈(VM Stack)
* 本地方法栈(Native Method Stack)
* PC寄存器(Program counter)
* 方法区(Method  Area)
* 堆区(Heap)

这些数据区域中大致可以划分为2类:

1. 线程独享:虚拟机栈、本地方法栈、PC寄存器。这些数据区与线程一一对应的，这些与线程对应的数据区域会随着线程开始和结束而创建和销毁。
每个线程都有自己私有的虚拟机栈、本地方法栈、PC寄存器。
2. 线程共享:方法区、堆区。随着虚拟机启动而创建，随着虚拟机退出而销毁，并且为为进程的所有子线程共享.

### Java虚拟机栈

虚拟机栈中的元素叫做栈帧（Stack Frame），线程在调用java方法时，会为每个方法创建一个栈帧，
来存储局部变量表、操作数栈、动态链接、方法出口等信息。每个方法被调用和完成的过程，
都对应着一个栈帧从虚拟机栈上入栈和出栈的过程。虚拟机栈的生命周期和线程相同.

栈帧随着方法调用而创建，随着方法结束而销毁——无论方法是正常完成还是异常完成
（抛出了在方法内未被捕获的异常）都算作方法结束。在一条线程之中，只有目前正在执行的那个方法的栈帧是活动的。
这个栈帧就被称为是当前栈帧（ Current Frame），这个栈帧对应的方法就被称为是当前方法（ Current Method），
定义这个方法的类就称作当前类（ Current Class）
栈帧是线程本地私有的数据，不可能在一个栈帧之中引用另外一条线程的栈帧。

### 本地方法栈

Java虚拟机实现可能会使用到传统的栈（通常称之为“ C Stacks”）来支持 native 方法（指使用Java以外的其他语言编写的方法）的执行，
这个栈就是本地方法栈（ Native Method Stack）。这个栈一般会在线程创建的时候按线程分配，
用来存储线程调用本地方法时，本地方法的局部变量表等信息。
本地方法栈和虚拟机栈所发挥的作用是非常相似的，区别是虚拟机栈执行Java方法,而本地方法栈则为虚拟机使用的Native方法服务，
在sun hotspot 虚拟机中已经把两者合二为一了.

### 堆(Heap)
    
Java堆是被所有线程共享的一块内存区域，在虚拟机启动时创建。 此区域的唯一目的就是存放对象实例，
几乎所有对象的实例都在这分配内存。 Java堆是垃圾收集器管理的主要区域，因此很多时候也被称为GC堆。
Java 堆在虚拟机启动的时候就被创建，它存储了被自动内存管理系统（ 也即是常说的“ Garbage Collector（垃圾收集器）”）
所管理的各种对象，这些受管理的对象无需，也无法显式地被销毁。 Java 堆的容量可以是固定大小的，
也可以随着程序执行的需求动态扩展，并在不需要过多空间时自动收缩.

### 方法区

在Java虚拟机中，方法区（Method Area）是可供各条线程共享的运行时内存区域。
它存储了每一个类的结构信息，例如字段信息(字段名等)和方法信息(方法名，返回类型等)、
类变量(使用static修饰的变量，叫做类变量，类变量是所有对象共享，
所以保存在方法区中)，构造函数和普通方法的字节码内容等。
方法区在虚拟机启动的时候被创建。


